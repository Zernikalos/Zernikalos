package mr.robotto.sample

import android.opengl.GLSurfaceView
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import mr.robotto.MrRenderingContext
import mr.robotto.MrRobotto
import mr.robotto.MrSceneStateHandler
import mr.robotto.loader.loadFromCborString
import mr.robotto.objects.MrScene
import mr.robotto.MrSceneContext
import mr.robotto.createDefaultSceneContext
import mr.robotto.createSceneContext

class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val robotto = MrRobotto()

        val renderSurface = findViewById<GLSurfaceView>(R.id.render_surface)

        robotto.attachView(renderSurface)

        robotto.attachStateHandler(object : MrSceneStateHandler {
            private val scene: MrScene = MrScene()

            override fun createSceneContext(): MrSceneContext {
                return createDefaultSceneContext(scene)
            }

            override fun onReady(sceneContext: MrSceneContext, renderingContext: MrRenderingContext) {
                val obj = loadFromCborString("826547726f7570a2646e616d6560686368696c6472656e8182654d6f64656ca4646d657368a367696e6469636573a36575736167656b7374617469632d6472617769646174614172726179406c74617267657442756666657267656c656d656e74687665727469636573a3627576a36575736167656b7374617469632d6472617769646174614172726179590120000000000000803f00000000000000000000803f0000803f00000000000000000000803f000000000000803f0000803f000000000000803f00000000000000000000803f0000803f00000000000000000000803f000000000000803f0000803f000000000000803f00000000000000000000803f0000803f00000000000000000000803f000000000000803f0000803f000000000000803f00000000000000000000803f0000803f00000000000000000000803f000000000000803f0000803f000000000000803f00000000000000000000803f0000803f00000000000000000000803f000000000000803f0000803f000000000000803f00000000000000000000803f0000803f00000000000000000000803f000000000000803f0000803f6c746172676574427566666572656172726179666e6f726d616ca36575736167656b7374617469632d64726177696461746141727261795901b00000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f00000000000000000000803f0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf0000000000000000000080bf6c74617267657442756666657265617272617968706f736974696f6ea36575736167656b7374617469632d64726177696461746141727261795901b00000803f0000803f0000803f0000803f000080bf0000803f0000803f0000803f000080bf0000803f000080bf0000803f0000803f000080bf000080bf0000803f0000803f000080bf000080bf0000803f000080bf000080bf000080bf000080bf000080bf0000803f0000803f000080bf000080bf000080bf000080bf000080bf0000803f000080bf0000803f0000803f000080bf0000803f000080bf000080bf0000803f0000803f0000803f0000803f000080bf000080bf0000803f0000803f0000803f0000803f0000803f0000803f0000803f000080bf000080bf000080bf0000803f000080bf000080bf000080bf0000803f000080bf0000803f000080bf000080bf000080bf0000803f000080bf000080bf0000803f000080bf0000803f000080bf0000803f0000803f000080bf000080bf0000803f0000803f0000803f0000803f000080bf000080bf0000803f0000803f000080bf0000803f0000803f0000803f0000803f0000803f0000803f000080bf0000803f000080bf000080bf000080bf0000803f000080bf0000803f000080bf000080bf000080bf000080bf000080bf000080bf0000803f000080bf6c7461726765744275666665726561727261796d6174747269627574654b657973a3627576a66473697a650265636f756e74182465696e64657802666f66667365740066737472696465006a6e6f726d616c697a6564f4666e6f726d616ca66473697a650365636f756e74182465696e64657801666f66667365740066737472696465006a6e6f726d616c697a6564f468706f736974696f6ea66473697a650365636f756e74182465696e64657800666f66667365740066737472696465006a6e6f726d616c697a6564f4646e616d6560686368696c6472656e806d73686164657250726f6772616da468756e69666f726d73a1734d6f64656c5669657750726f6a656374696f6ea36474797065646d61743465636f756e74016b756e69666f726d4e616d65696d76704d61747269786a61747472696275746573a3627576a265696e646578026d6174747269627574654e616d65627576666e6f726d616ca265696e646578016d6174747269627574654e616d65666e6f726d616c68706f736974696f6ea265696e646578006d6174747269627574654e616d6568706f736974696f6e6c766572746578536861646572a264747970656676657274657866736f757263657901142376657273696f6e203330302065730a0a756e69666f726d206d617434206d76704d61747269783b0a696e207665633320706f736974696f6e3b0a696e2076656333206e6f726d616c3b0a696e20766563322075763b0a0a766f6964206d61696e2829207b0a20202020676c5f506f736974696f6e203d206d61743428312e333733373338373039373237333131332c20302c20302c20302c20302c20312e333834343731303433333937303535372c20302c20302c20302c20302c202d312e30323032303230323032303230322c202d312c20302c20302c202d322e303230323032303230323032303230332c203029202a206d76704d6174726978202a207665633428706f736974696f6e2c31293b0a7d0a6e667261676d656e74536861646572a2647479706568667261676d656e7466736f7572636578742376657273696f6e203330302065730a0a707265636973696f6e206d656469756d7020666c6f61743b0a0a6f75742076656334206f7574436f6c6f723b0a0a766f6964206d61696e2829207b0a20206f7574436f6c6f72203d207665633428302e352c20302e352c20302e352c2031293b0a7d0a")

                obj.transform.translate(0f, 0f, -6f)
                scene.addChild(obj)

                scene.initialize(sceneContext, renderingContext)
            }

            override fun onResize(width: Int, height: Int) {
            }

            override fun onRender(sceneContext: MrSceneContext, renderingContext: MrRenderingContext) {
                scene.render(sceneContext, renderingContext)
            }

        })

    }
}